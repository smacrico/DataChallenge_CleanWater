# Water Quality South Africa Predictor - Project Configuration

# Landsat Feature Join Configuration
landsat:
  max_lag_days: 60
  prefer_non_future: true
  # Prefer scenes on or before sample date; fallback to nearest within ±60 days

# TerraClimate Feature Join Configuration
terraclimate:
  month_join: same_then_previous
  # Join same month first; if missing, use previous month

# Feature Columns
features:
  # Landsat-derived features (NDVI, NDBI, NDWI + cloud/coverage metadata)
  landsat:
    - NDVI_MEAN_B250
    - NDBI_MEAN_B1K
    - NDWI_MEAN_B250
    - CLOUD_FRAC_B250
    - LANDSAT_LOW_COVERAGE_FLAG
    - SCENE_GAP_DAYS
  
  # TerraClimate monthly + rolling window features + seasonality
  terraclimate:
    - PPT_M0          # Precipitation current month
    - PPT_SUM_M1      # 1-month rolling sum
    - PPT_SUM_M3      # 3-month rolling sum
    - PPT_SUM_M6      # 6-month rolling sum
    - Q_M0            # Runoff current month
    - Q_SUM_M1        # 1-month rolling runoff
    - Q_SUM_M3        # 3-month rolling runoff
    - VPD_M0          # Vapor Pressure Deficit current month
    - VPD_MEAN_M3     # 3-month rolling mean VPD
    - DEF_M0          # Water Deficit current month
    - DEF_MEAN_M3     # 3-month rolling mean deficit
    - MON_SIN         # Seasonality encoding: sin(2π × month/12)
    - MON_COS         # Seasonality encoding: cos(2π × month/12)

# Target Variables (in submission order)
targets:
  - ALKALINITY
  - EC
  - DRP

# Model Training Configuration
modeling:
  cv_splits: 5
  group_by: STATION_KEY
  random_state: 42
  
  # Model selection priority
  model_priority:
    - xgboost  # Try XGBRegressor first
    - rf       # Fallback to RandomForestRegressor
  
  # XGBoost hyperparameters (if available)
  xgboost:
    n_estimators: 300
    max_depth: 6
    learning_rate: 0.05
    subsample: 0.8
    colsample_bytree: 0.8
    random_state: 42
    n_jobs: -1
  
  # RandomForest hyperparameters (fallback)
  random_forest:
    n_estimators: 300
    max_depth: 15
    min_samples_split: 5
    min_samples_leaf: 2
    random_state: 42
    n_jobs: -1
  
  # Blender configuration (optional Ridge meta-learner)
  blender:
    enabled: true
    alpha: 1.0
    random_state: 42

# Validation Configuration
validation:
  method: groupkfold
  spatial_generalization: true
  
# Output Paths (relative to project root)
paths:
  models: models
  artifacts: artifacts
  data: data
  logs: logs

# Snowflake Table Names
snowflake:
  tables:
    train_gold: TRAIN_GOLD
    valid_gold: VALID_GOLD
    submission_template: SUBMISSION_TEMPLATE

# Logging
logging:
  level: INFO
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
